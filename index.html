<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pomodoro Timer</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="container">
    <div class="right-column">
      <iframe
        id="focus-video"
        width="700"
        height="394"
        src="https://www.youtube.com/embed/9Y8OA70vmeY?autoplay=1&mute=1&controls=0&loop=1&playlist=9Y8OA70vmeY&enablejsapi=1&playsinline=1"
        title="YouTube video player"
        frameborder="0"
        allow="autoplay; encrypted-media; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen>
      </iframe>
    </div>

    <div class="left-column">
      <div class="timer-box">
        <!-- Presets -->
        <div class="presets" id="presets" role="tablist" aria-label="Timer presets">
          <button id="mode-20" class="preset active" data-mode="work20" role="tab" aria-selected="true">20:00 Focus</button>
          <button id="mode-7"  class="preset" data-mode="break7" role="tab" aria-selected="false">7:00 Break</button>
        </div>

        <!-- Timer -->
        <div id="timer" aria-live="polite" aria-atomic="true">
          <span id="minutes">20</span>:<span id="seconds">00</span>
        </div>

        <!-- Controls -->
        <div class="buttons">
          <button id="start-pause">Start</button>
          <button id="reset">Reset</button>
          <!-- NEW: Sound toggle -->
          <button id="toggle-sound" aria-pressed="false" title="Toggle sound (M)">Sound: Off</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Your existing timer logic -->
  <script src="script.js"></script>

  <audio id="timer-end-sound" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2023/07/19/audio_25fe3bfc7c.mp3?filename=forest-birds-nature-sound-145204.mp3" type="audio/mp3">
  </audio>

  <!-- YouTube API + controls -->
  <script>
    // Load the YouTube IFrame API
    (function loadYT() {
      const tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(tag);
    })();

    let ytPlayer;

    // Called by the YT API when ready
    function onYouTubeIframeAPIReady() {
      ytPlayer = new YT.Player('focus-video', {
        events: {
          onReady: (e) => {
            e.target.mute();      // start muted so autoplay works
            e.target.playVideo(); // begin playback
            syncSoundLabel();     // reflect current mute state in the button
          }
        }
      });
    }

    // Helper: update the Sound button label/state
    function syncSoundLabel() {
      const btn = document.getElementById('toggle-sound');
      if (!btn || !ytPlayer) return;
      const muted = ytPlayer.isMuted();
      btn.textContent = muted ? 'Sound: Off' : 'Sound: On';
      btn.setAttribute('aria-pressed', muted ? 'false' : 'true');
    }

    // Unmute on the FIRST Start click (user gesture)
    document.addEventListener("DOMContentLoaded", () => {
      const startBtn = document.getElementById('start-pause');
      const soundBtn = document.getElementById('toggle-sound');

      function unmuteOnFirstStart() {
        if (window.ytPlayer && typeof ytPlayer.unMute === 'function') {
          try {
            ytPlayer.unMute();
            ytPlayer.setVolume(100);
            ytPlayer.playVideo();
            syncSoundLabel();
          } catch (e) { /* ignore */ }
        }
        startBtn.removeEventListener('click', unmuteOnFirstStart);
      }
      if (startBtn) startBtn.addEventListener('click', unmuteOnFirstStart, { once: true });

      // Sound toggle button
      if (soundBtn) {
        soundBtn.addEventListener('click', () => {
          if (!ytPlayer) return;
          try {
            if (ytPlayer.isMuted()) {
              ytPlayer.unMute();
              ytPlayer.setVolume(100);
              ytPlayer.playVideo();
            } else {
              ytPlayer.mute();
            }
          } catch (e) { /* ignore */ }
          syncSoundLabel();
        });
      }

      // Keyboard: M to toggle sound
      window.addEventListener('keydown', (e) => {
        if ((e.key === 'm' || e.key === 'M') && ytPlayer) {
          try {
            if (ytPlayer.isMuted()) {
              ytPlayer.unMute();
              ytPlayer.setVolume(100);
              ytPlayer.playVideo();
            } else {
              ytPlayer.mute();
            }
          } catch (e) { /* ignore */ }
          syncSoundLabel();
        }
      });
    });
  </script>
</body>
</html>
